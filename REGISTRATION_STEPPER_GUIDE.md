# Руководство по использованию многоэтапного степера регистрации

## Обзор

Многоэтапный степер регистрации реализует 4-этапный процесс регистрации пользователей с верификацией по email или SMS согласно предоставленной документации.

## Быстрый старт

### 1. Использование в компоненте

```tsx
import { RegistrationStepper } from '@/components/registration/RegistrationStepper';

function MyPage() {
  const handleComplete = () => {
    console.log('Регистрация завершена!');
    // Перенаправление или другие действия
  };

  return (
    <div>
      <h1>Регистрация</h1>
      <RegistrationStepper onComplete={handleComplete} />
    </div>
  );
}
```

### 2. Переключение между режимами

В `RegisterClient.tsx` уже реализовано переключение между простой и многоэтапной регистрацией:

```tsx
const [useMultiStep, setUseMultiStep] = useState(true);

// Переключение на многоэтапную регистрацию
<button onClick={() => setUseMultiStep(true)}>
  Use multi-step registration
</button>

// Переключение на простую регистрацию
<button onClick={() => setUseMultiStep(false)}>
  Use simple registration instead
</button>
```

## Этапы регистрации

### Этап 1: Контактная информация

- Ввод email или украинского номера телефона
- Валидация формата данных
- Отправка кода верификации

### Этап 2: Верификация кода

- Ввод 6-значного кода
- Автоматическое форматирование ввода
- Таймер для повторной отправки кода
- Возможность возврата на предыдущий этап

### Этап 3: Создание пароля

- Ввод пароля с проверкой сложности
- Визуальный индикатор силы пароля
- Подтверждение пароля
- Требования к паролю: минимум 8 символов, заглавные/строчные буквы, цифры

### Этап 4: Личная информация (необязательно)

- Ввод имени и фамилии
- Возможность пропустить этап
- Возможность вернуться на предыдущий этап

## API и типы

### Основные типы

```typescript
// Состояние регистрации
interface RegistrationState {
  currentStep: RegistrationStep; // 1 | 2 | 3 | 4
  userId?: string;
  tempToken?: string;
  accessToken?: string;
  refreshToken?: string;
  user?: UserData;
  method?: 'email' | 'sms';
  error?: string;
  isLoading: boolean;
}

// Данные форм для каждого этапа
interface Step1FormData {
  email?: string;
  phone?: string;
}

interface Step2FormData {
  code: string;
}

interface Step3FormData {
  password: string;
  confirmPassword: string;
}

interface Step4FormData {
  firstName?: string;
  lastName?: string;
}
```

### Хук useRegistration

```typescript
const {
  state, // Текущее состояние
  startRegistration, // Начать регистрацию (этап 1)
  verifyCode, // Верифицировать код (этап 2)
  setPassword, // Установить пароль (этап 3)
  setPersonalInfo, // Установить личную информацию (этап 4)
  resendCode, // Повторно отправить код
  goBackStep, // Вернуться на предыдущий этап
  resetRegistration, // Сбросить регистрацию
  skipPersonalInfo, // Пропустить личную информацию
  setError, // Установить ошибку
  clearError, // Очистить ошибку
} = useRegistration();
```

## Валидация

### Email

- Стандартная валидация email адреса
- Обязателен, если не указан телефон

### Телефон

- Украинские номера: `+380XXXXXXXXX` или `0XXXXXXXXX`
- Обязателен, если не указан email

### Пароль

- Минимум 8 символов
- Заглавные и строчные буквы
- Цифры
- Визуальный индикатор сложности

### Код верификации

- Ровно 6 цифр
- Автоматическое форматирование ввода

## Стилизация

Компоненты используют существующую UI библиотеку проекта:

- `Button` - кнопки
- `Input` - поля ввода
- `Label` - метки
- `Card` - карточки
- `AlertCircle`, `Loader2` и другие иконки из Lucide React

## Обработка ошибок

Все ошибки отображаются в едином стиле:

```tsx
{
  error && (
    <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-md text-sm flex items-center gap-2">
      <AlertCircle className="h-4 w-4" />
      {error}
    </div>
  );
}
```

## Интеграция с GraphQL

В настоящее время используется симуляция API. Для интеграции с реальным бэкендом:

1. Добавьте мутации в `src/graphql/mutations/auth.graphql`
2. Обновите хук `useRegistration` для использования реальных мутаций
3. Настройте обработку ошибок API

## Отладка

В development режиме отображается debug информация:

- Текущий этап
- Состояние токенов
- Ошибки
- Метод верификации

## Мобильная адаптация

Компоненты адаптированы для мобильных устройств:

- Responsive дизайн
- Touch-friendly элементы управления
- Оптимизированные размеры полей ввода

## Безопасность

- Временные токены с ограниченным временем жизни
- Валидация на клиенте и сервере
- Безопасное хранение состояния
- Автоматическая очистка чувствительных данных

## Производительность

- Ленивая загрузка компонентов
- Мемоизация состояний
- Оптимизированные ре-рендеры
- Минимальные зависимости

## Тестирование

Созданы базовые тесты в `src/components/registration/__tests__/`:

- Тестирование рендеринга
- Тестирование состояний
- Моки для внешних зависимостей

## Будущие улучшения

1. **Реальная интеграция с GraphQL** - замена симуляции на реальные мутации
2. **Анимации переходов** - плавные переходы между этапами
3. **Интернационализация** - поддержка множественных языков
4. **Расширенная валидация** - дополнительные проверки данных
5. **Аналитика** - отслеживание прогресса регистрации
6. **A/B тестирование** - различные варианты UI
